<UserControl x:Class="PGI.Views.Stocks.ProductFormView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d"
             d:DesignHeight="900" d:DesignWidth="1100"
             Background="Transparent">
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        
        <!-- En-tÃªte -->
        <Border Grid.Row="0" Background="Transparent" Margin="0,0,0,20">
            <Grid>
                <TextBlock Text="Fiche Produit" FontSize="20" FontWeight="Bold" Foreground="#1E293B" VerticalAlignment="Center"/>
                
                <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                    <Button Content="â† Retour Ã  la liste" 
                            Background="Transparent" 
                            Foreground="#64748B"
                            BorderThickness="0"
                            Padding="15,10"
                            FontWeight="Medium"
                            FontSize="13"
                            Cursor="Hand"
                            Click="BtnBack_Click"/>
                </StackPanel>
            </Grid>
        </Border>
        
        <!-- Onglets -->
        <Border Grid.Row="1" Background="White" CornerRadius="12" BorderBrush="#E2E8F0" BorderThickness="1">
            <Border.Effect>
                <DropShadowEffect Color="#CBD5E1" BlurRadius="20" ShadowDepth="0" Opacity="0.4"/>
            </Border.Effect>
            <TabControl Background="Transparent" BorderThickness="0">
                <TabControl.Resources>
                    <Style TargetType="TabItem">
                        <Setter Property="FontSize" Value="14"/>
                        <Setter Property="FontWeight" Value="Medium"/>
                        <Setter Property="Padding" Value="20,12"/>
                        <Setter Property="Template">
                            <Setter.Value>
                                <ControlTemplate TargetType="TabItem">
                                    <Border Name="Border" 
                                            Background="Transparent" 
                                            BorderThickness="0,0,0,2"
                                            BorderBrush="Transparent"
                                            Padding="{TemplateBinding Padding}">
                                        <ContentPresenter ContentSource="Header"/>
                                    </Border>
                                    <ControlTemplate.Triggers>
                                        <Trigger Property="IsSelected" Value="True">
                                            <Setter TargetName="Border" Property="BorderBrush" Value="#669BBC"/>
                                            <Setter Property="Foreground" Value="#003049"/>
                                            <Setter Property="FontWeight" Value="SemiBold"/>
                                        </Trigger>
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Setter TargetName="Border" Property="Background" Value="#F8FAFC"/>
                                        </Trigger>
                                    </ControlTemplate.Triggers>
                                </ControlTemplate>
                            </Setter.Value>
                        </Setter>
                    </Style>
                </TabControl.Resources>
                
                <!-- Onglet 1: Informations gÃ©nÃ©rales -->
                <TabItem Header="â„¹ï¸ Informations gÃ©nÃ©rales">
                    <ScrollViewer VerticalScrollBarVisibility="Auto">
                        <StackPanel Margin="30">
                            <TextBlock Text="DÃ©tails du produit" FontSize="16" FontWeight="SemiBold" Foreground="#1E293B" Margin="0,0,0,20"/>
                            
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="20"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                
                                <StackPanel Grid.Column="0">
                                    <TextBlock Text="Nom du produit *" FontSize="13" FontWeight="SemiBold" Foreground="#475569" Margin="0,0,0,8"/>
                                    <TextBox x:Name="TxtNom" Height="40" Padding="12,8" BorderBrush="#E2E8F0" BorderThickness="1"/>
                                    
                                    <TextBlock Text="SKU *" FontSize="13" FontWeight="SemiBold" Foreground="#475569" Margin="0,20,0,8"/>
                                    <TextBox x:Name="TxtSKU" Height="40" Padding="12,8" BorderBrush="#E2E8F0" BorderThickness="1"/>
                                    
                                    <TextBlock Text="CatÃ©gorie *" FontSize="13" FontWeight="SemiBold" Foreground="#475569" Margin="0,20,0,8"/>
                                    <ComboBox x:Name="CmbCategorie" Height="40" Padding="12,8" BorderBrush="#E2E8F0" BorderThickness="1" DisplayMemberPath="Nom" SelectedValuePath="Id"/>
                                </StackPanel>
                                
                                <StackPanel Grid.Column="2">
                                    <TextBlock Text="Statut *" FontSize="13" FontWeight="SemiBold" Foreground="#475569" Margin="0,0,0,8"/>
                                    <ComboBox x:Name="CmbStatut" Height="40" Padding="12,8" BorderBrush="#E2E8F0" BorderThickness="1">
                                        <ComboBoxItem Content="Actif" IsSelected="True"/>
                                        <ComboBoxItem Content="Inactif"/>
                                    </ComboBox>
                                    
                                    <TextBlock Text="Description" FontSize="13" FontWeight="SemiBold" Foreground="#475569" Margin="0,20,0,8"/>
                                    <TextBox x:Name="TxtDescription" Height="120" Padding="12,8" BorderBrush="#E2E8F0" BorderThickness="1" TextWrapping="Wrap" AcceptsReturn="True"/>
                                </StackPanel>
                            </Grid>
                        </StackPanel>
                    </ScrollViewer>
                </TabItem>
                
                <!-- Onglet 2: Tarification et Fournisseur -->
                <TabItem Header="ðŸ’° Tarification">
                    <ScrollViewer VerticalScrollBarVisibility="Auto">
                        <StackPanel Margin="30">
                            <TextBlock Text="Prix et marges" FontSize="16" FontWeight="SemiBold" Foreground="#1E293B" Margin="0,0,0,20"/>
                            
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="20"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                
                                <StackPanel Grid.Column="0">
                                    <TextBlock Text="CoÃ»t d'achat * ($)" FontSize="13" FontWeight="SemiBold" Foreground="#475569" Margin="0,0,0,8"/>
                                    <TextBox x:Name="TxtCout" Height="40" Padding="12,8" BorderBrush="#E2E8F0" BorderThickness="1" TextChanged="CalculateMarge"/>
                                    
                                    <TextBlock Text="Prix de vente * ($)" FontSize="13" FontWeight="SemiBold" Foreground="#475569" Margin="0,20,0,8"/>
                                    <TextBox x:Name="TxtPrix" Height="40" Padding="12,8" BorderBrush="#E2E8F0" BorderThickness="1" TextChanged="CalculateMarge"/>
                                    
                                    <Border Background="#EEF2FF" CornerRadius="8" Padding="15" Margin="0,20,0,0">
                                        <StackPanel>
                                            <TextBlock Text="ðŸ“Š Marge brute calculÃ©e" FontSize="13" FontWeight="SemiBold" Foreground="#003049" Margin="0,0,0,5"/>
                                            <TextBlock x:Name="TxtMarge" Text="0.00 %" FontSize="24" FontWeight="Bold" Foreground="#669BBC"/>
                                        </StackPanel>
                                    </Border>
                                </StackPanel>
                                
                                <StackPanel Grid.Column="2">
                                    <TextBlock Text="Fournisseur *" FontSize="13" FontWeight="SemiBold" Foreground="#475569" Margin="0,0,0,8"/>
                                    <ComboBox x:Name="CmbFournisseur" Height="40" Padding="12,8" BorderBrush="#E2E8F0" BorderThickness="1" DisplayMemberPath="Nom" SelectedValuePath="Id" SelectionChanged="CmbFournisseur_SelectionChanged"/>
                                    
                                    <Border x:Name="BorderFournisseurInfo" Background="#FEF3C7" CornerRadius="8" Padding="15" Margin="0,20,0,0" Visibility="Collapsed">
                                        <StackPanel>
                                            <TextBlock Text="â„¹ï¸ Informations fournisseur" FontSize="12" FontWeight="SemiBold" Foreground="#92400E" Margin="0,0,0,8"/>
                                            <TextBlock x:Name="TxtDelaiLivraison" Text="â€¢ DÃ©lai de livraison: - jours" FontSize="11" Foreground="#475569" Margin="0,0,0,4"/>
                                            <TextBlock x:Name="TxtEscompte" Text="â€¢ Escompte: -%" FontSize="11" Foreground="#475569"/>
                                        </StackPanel>
                                    </Border>
                                </StackPanel>
                            </Grid>
                        </StackPanel>
                    </ScrollViewer>
                </TabItem>
                
                <!-- Onglet 3: Inventaire et Stock -->
                <TabItem Header="ðŸ“¦ Inventaire">
                    <ScrollViewer VerticalScrollBarVisibility="Auto">
                        <StackPanel Margin="30">
                            <TextBlock Text="Gestion des stocks" FontSize="16" FontWeight="SemiBold" Foreground="#1E293B" Margin="0,0,0,20"/>
                            
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="20"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                
                                <StackPanel Grid.Column="0">
                                    <Border Background="#F0FDF4" CornerRadius="8" Padding="15" Margin="0,0,0,15">
                                        <StackPanel>
                                            <TextBlock Text="Stock actuel" FontSize="12" Foreground="#64748B" Margin="0,0,0,5"/>
                                            <TextBlock x:Name="TxtStockActuel" Text="0 unitÃ©s" FontSize="20" FontWeight="Bold" Foreground="#10B981"/>
                                        </StackPanel>
                                    </Border>
                                    
                                    <Border Background="#EEF2FF" CornerRadius="8" Padding="15" Margin="0,0,0,15">
                                        <StackPanel>
                                            <TextBlock Text="QuantitÃ© rÃ©servÃ©e" FontSize="12" Foreground="#64748B" Margin="0,0,0,5"/>
                                            <TextBlock x:Name="TxtStockReserve" Text="0 unitÃ©s" FontSize="20" FontWeight="Bold" Foreground="#669BBC"/>
                                        </StackPanel>
                                    </Border>
                                    
                                    <Border Background="#FEF3C7" CornerRadius="8" Padding="15">
                                        <StackPanel>
                                            <TextBlock Text="Stock disponible" FontSize="12" Foreground="#64748B" Margin="0,0,0,5"/>
                                            <TextBlock x:Name="TxtStockDisponible" Text="0 unitÃ©s" FontSize="20" FontWeight="Bold" Foreground="#92400E"/>
                                        </StackPanel>
                                    </Border>
                                </StackPanel>
                                
                                <StackPanel Grid.Column="2">
                                    <TextBlock Text="Seuil de rÃ©approvisionnement *" FontSize="13" FontWeight="SemiBold" Foreground="#475569" Margin="0,0,0,8"/>
                                    <TextBox x:Name="TxtSeuil" Height="40" Padding="12,8" BorderBrush="#E2E8F0" BorderThickness="1"/>
                                    
                                    <TextBlock Text="Stock minimum *" FontSize="13" FontWeight="SemiBold" Foreground="#475569" Margin="0,20,0,8"/>
                                    <TextBox x:Name="TxtStockMinimum" Height="40" Padding="12,8" BorderBrush="#E2E8F0" BorderThickness="1"/>
                                    
                                    <TextBlock Text="Poids (kg)" FontSize="13" FontWeight="SemiBold" Foreground="#475569" Margin="0,20,0,8"/>
                                    <TextBox x:Name="TxtPoids" Height="40" Padding="12,8" BorderBrush="#E2E8F0" BorderThickness="1"/>
                                </StackPanel>
                            </Grid>
                        </StackPanel>
                    </ScrollViewer>
                </TabItem>
                
                <!-- Onglet 4: Historique -->
                <TabItem Header="ðŸ• Historique">
                    <StackPanel Margin="30">
                        <TextBlock Text="Mouvements de stock pour ce produit" FontSize="16" FontWeight="SemiBold" Foreground="#1E293B" Margin="0,0,0,20"/>
                        
                        <DataGrid AutoGenerateColumns="False" 
                                RowHeight="45"
                                HeadersVisibility="Column"
                                GridLinesVisibility="None"
                                Background="Transparent"
                                BorderThickness="0"
                                CanUserAddRows="False"
                                CanUserDeleteRows="False"
                                IsReadOnly="True"
                                SelectionMode="Single"
                                FontSize="13">
                            <DataGrid.ColumnHeaderStyle>
                                <Style TargetType="DataGridColumnHeader">
                                    <Setter Property="Background" Value="#F8FAFC"/>
                                    <Setter Property="Foreground" Value="#64748B"/>
                                    <Setter Property="FontWeight" Value="SemiBold"/>
                                    <Setter Property="FontSize" Value="12"/>
                                    <Setter Property="Padding" Value="15,12"/>
                                    <Setter Property="BorderThickness" Value="0,0,0,1"/>
                                    <Setter Property="BorderBrush" Value="#E2E8F0"/>
                                </Style>
                            </DataGrid.ColumnHeaderStyle>
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="Date/Heure" Binding="{Binding Date}" Width="150"/>
                                <DataGridTextColumn Header="Type" Binding="{Binding Type}" Width="80"/>
                                <DataGridTextColumn Header="QuantitÃ©" Binding="{Binding Quantite}" Width="100"/>
                                <DataGridTextColumn Header="Motif" Binding="{Binding Motif}" Width="*"/>
                                <DataGridTextColumn Header="Utilisateur" Binding="{Binding Utilisateur}" Width="150"/>
                            </DataGrid.Columns>
                        </DataGrid>
                    </StackPanel>
                </TabItem>
            </TabControl>
        </Border>
        
        <!-- Boutons d'action -->
        <Border Grid.Row="2" Background="Transparent" Margin="0,20,0,0">
            <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                <Button Content="Annuler" 
                        Background="White" 
                        Foreground="#64748B"
                        BorderThickness="2"
                        BorderBrush="#E2E8F0"
                        Padding="20,12"
                        FontWeight="SemiBold"
                        FontSize="14"
                        Cursor="Hand"
                        Margin="0,0,12,0"
                        Click="BtnCancel_Click">
                    <Button.Style>
                        <Style TargetType="Button">
                            <Setter Property="Template">
                                <Setter.Value>
                                    <ControlTemplate TargetType="Button">
                                        <Border Background="{TemplateBinding Background}" 
                                                BorderBrush="{TemplateBinding BorderBrush}"
                                                BorderThickness="{TemplateBinding BorderThickness}"
                                                CornerRadius="8" 
                                                Padding="{TemplateBinding Padding}">
                                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                        </Border>
                                    </ControlTemplate>
                                </Setter.Value>
                            </Setter>
                        </Style>
                    </Button.Style>
                </Button>
                
                <Button Content="ðŸ’¾ Enregistrer" 
                        Background="#669BBC" 
                        Foreground="White"
                        BorderThickness="0"
                        Padding="25,12"
                        FontWeight="SemiBold"
                        FontSize="14"
                        Cursor="Hand"
                        Click="BtnSave_Click">
                    <Button.Style>
                        <Style TargetType="Button">
                            <Setter Property="Template">
                                <Setter.Value>
                                    <ControlTemplate TargetType="Button">
                                        <Border Background="{TemplateBinding Background}" 
                                                CornerRadius="8" 
                                                Padding="{TemplateBinding Padding}">
                                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                        </Border>
                                    </ControlTemplate>
                                </Setter.Value>
                            </Setter>
                            <Style.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter Property="Background" Value="#003049"/>
                                </Trigger>
                            </Style.Triggers>
                        </Style>
                    </Button.Style>
                </Button>
            </StackPanel>
        </Border>
    </Grid>
</UserControl>

